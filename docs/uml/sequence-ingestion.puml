@startuml ingestion

actor Operator
participant IngestionUI
participant DocumentIngestController
participant PdfService
participant DocumentIngestService
participant LLMClient
participant VectorStoreAdapter
participant Logger

Operator -> IngestionUI: Upload PDF
IngestionUI -> DocumentIngestController: ingest(fileBuffer, docId)

DocumentIngestController -> PdfService: extractText(fileBuffer)
PdfService --> DocumentIngestController: rawText

DocumentIngestController -> DocumentIngestService: splitIntoChunks(rawText)
DocumentIngestService --> DocumentIngestController: chunks

DocumentIngestController -> LLMClient: embed(chunks.text)
LLMClient --> DocumentIngestController: embeddings

DocumentIngestController -> VectorStoreAdapter: upsert(docId, chunks + embeddings)
VectorStoreAdapter --> DocumentIngestController: ack

DocumentIngestController -> Logger: logIngestion(docId, "OK")
Logger --> DocumentIngestController: logged

DocumentIngestController --> IngestionUI: ingestionStatus

@enduml
